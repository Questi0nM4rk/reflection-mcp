# =============================================================================
# STRICT Pre-Commit Configuration for AI-Driven Development
# =============================================================================
# All checks run in strictest mode. No exceptions. No bypasses.
# AI agents need guardrails - this is the fence.
#
# Languages: Python, TypeScript, C#/.NET, Shell, Markdown
# Dormant hooks auto-skip if no matching files exist.
# =============================================================================

fail_fast: true
default_language_version:
  python: python3.12
  node: "20.11.0"

repos:
  # ===========================================================================
  #  SECURITY - CRITICAL (runs first, fails fast)
  # ===========================================================================

  # Detect hardcoded secrets, API keys, passwords
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.21.2
    hooks:
      - id: gitleaks
        name: " security 路 gitleaks - detect secrets"

  # Detect private keys
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: detect-private-key
        name: " security 路 detect private keys"

  # ===========================================================================
  #  PYTHON - STRICT MODE
  # ===========================================================================

  # Ruff - Fast linter (replaces flake8, isort, pyupgrade, etc.)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.6
    hooks:
      - id: ruff
        name: " python 路 ruff lint (strict)"
        args: [
          "--fix",
          "--exit-non-zero-on-fix",
          "--select=ALL",
          "--ignore=D,ANN,COM812,ISC001",
        ]
      - id: ruff-format
        name: " python 路 ruff format"

  # Pyright - Strict type checking
  - repo: https://github.com/RobertCraigie/pyright-python
    rev: v1.1.391
    hooks:
      - id: pyright
        name: " python 路 pyright type check (strict)"
        args: ["--warnings"]

  # Bandit - Security linter for Python
  - repo: https://github.com/PyCQA/bandit
    rev: 1.8.0
    hooks:
      - id: bandit
        name: " python 路 bandit security scan"
        args: ["-r", "src/", "-ll", "-ii"]
        pass_filenames: false

  # Validate pyproject.toml
  - repo: https://github.com/abravalheri/validate-pyproject
    rev: v0.23
    hooks:
      - id: validate-pyproject
        name: " python 路 validate pyproject.toml"
        additional_dependencies: ["validate-pyproject-schema-store[all]"]

  # ===========================================================================
  #  TYPESCRIPT/JAVASCRIPT - STRICT MODE (dormant if no TS/JS files)
  # ===========================================================================

  # Biome - Fast linter + formatter (replaces ESLint + Prettier)
  - repo: https://github.com/biomejs/pre-commit
    rev: "v0.6.1"
    hooks:
      - id: biome-check
        name: " typescript 路 biome lint+format (strict)"
        additional_dependencies: ["@biomejs/biome@1.9.4"]
        args: [
          "--error-on-warnings",
          "--diagnostic-level=info",
        ]

  # TypeScript type checking (local hook)
  - repo: local
    hooks:
      - id: tsc
        name: " typescript 路 tsc type check (strict)"
        entry: npx tsc
        args: ["--noEmit", "--strict", "--skipLibCheck"]
        language: system
        types: [ts, tsx]
        pass_filenames: false

  # ===========================================================================
  #  C# / .NET - STRICT MODE (dormant if no .cs files)
  # ===========================================================================

  - repo: local
    hooks:
      # dotnet format - Code style enforcement
      - id: dotnet-format
        name: " csharp 路 dotnet format (strict)"
        entry: dotnet format
        args: [
          "--verify-no-changes",
          "--verbosity", "normal",
          "--severity", "info",
        ]
        language: system
        types: [c#]
        pass_filenames: false

      # dotnet build - Compilation check (catches errors + warnings as errors)
      - id: dotnet-build
        name: " csharp 路 dotnet build (warnings as errors)"
        entry: dotnet build
        args: [
          "--no-restore",
          "-warnaserror",
          "-c", "Release",
        ]
        language: system
        types: [c#]
        pass_filenames: false

  # ===========================================================================
  #  SHELL - STRICT MODE
  # ===========================================================================

  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.10.0.1
    hooks:
      - id: shellcheck
        name: " shell 路 shellcheck lint"
        args: ["--severity=warning"]

  # ===========================================================================
  #  MARKDOWN - STRICT MODE
  # ===========================================================================

  - repo: https://github.com/DavidAnson/markdownlint-cli2
    rev: v0.17.2
    hooks:
      - id: markdownlint-cli2
        name: " markdown 路 markdownlint"

  # ===========================================================================
  #  CONFIG & DATA VALIDATION
  # ===========================================================================

  - repo: https://github.com/python-jsonschema/check-jsonschema
    rev: 0.30.0
    hooks:
      - id: check-github-workflows
        name: " github 路 validate workflow files"
        args: ["--verbose"]
      - id: check-github-actions
        name: " github 路 validate action files"

  # ===========================================================================
  #  UNIVERSAL QUALITY CHECKS
  # ===========================================================================

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      # Whitespace & formatting
      - id: trailing-whitespace
        name: " format 路 trailing whitespace"
        args: [--markdown-linebreak-ext=md]
      - id: end-of-file-fixer
        name: " format 路 end of file fixer"
      - id: mixed-line-ending
        name: " format 路 mixed line endings"
        args: [--fix=lf]

      # Syntax validation
      - id: check-yaml
        name: " syntax 路 check yaml"
        args: [--unsafe]
      - id: check-json
        name: " syntax 路 check json"
      - id: check-toml
        name: " syntax 路 check toml"
      - id: check-xml
        name: " syntax 路 check xml"

      # Git hygiene
      - id: check-merge-conflict
        name: " git 路 check merge conflicts"
      - id: check-added-large-files
        name: " git 路 check large files"
        args: [--maxkb=500]
      - id: no-commit-to-branch
        name: " git 路 no commit to main"
        args: [--branch=main, --branch=master]

      # Code quality
      - id: check-ast
        name: " python 路 check ast"
      - id: check-docstring-first
        name: " python 路 docstring first"
      - id: debug-statements
        name: " python 路 debug statements"
      - id: check-builtin-literals
        name: " python 路 builtin literals"

      # File checks
      - id: check-case-conflict
        name: " files 路 case conflict"
      - id: check-symlinks
        name: " files 路 broken symlinks"

  # ===========================================================================
  # И TESTS - Run pytest (local hook)
  # ===========================================================================

  - repo: local
    hooks:
      - id: pytest
        name: "И tests 路 pytest"
        entry: uv run pytest
        args: [tests/, -v, --tb=short, -q]
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-commit]

# =============================================================================
# CI Note: This config is also used in GitHub Actions
# Install: pip install pre-commit && pre-commit install
# Run all: pre-commit run --all-files
#
# Dormant hooks (TS, C#) auto-skip if no matching files exist.
# =============================================================================
